# ── FillWise 3.0  ·  Environment Configuration ──────────────────────────────
# Copy this file to .env and fill in every value.
# All fields marked [REQUIRED] MUST be set before first run.
# Fields marked [DEFAULT] have sensible defaults but CAN be overridden.
#
# DO NOT commit .env to version control.
# See docs/OPERATOR_GUIDE.md for full field explanations.
# ─────────────────────────────────────────────────────────────────────────────

# ── Application ───────────────────────────────────────────────────────────────

# Human-readable app name shown in API responses and logs.
# [DEFAULT]
APP_NAME=FillWise

# Semantic version string.
# [DEFAULT]
APP_VERSION=3.0.0

# Set to "development" locally; MUST be "production" in production deployments.
# [REQUIRED]
ENVIRONMENT=development

# Enable debug output and auto-reload.  MUST be false in production.
# [DEFAULT]
DEBUG=false

# Enable Uvicorn auto-reload.  MUST be false in production.
# [DEFAULT]
RELOAD=false

# Host and port for Uvicorn.
# [DEFAULT]
HOST=0.0.0.0
PORT=8000

# Number of Uvicorn worker processes (gunicorn mode).  Ignored by `make dev`.
# [DEFAULT]
WORKERS=4

# Log level: DEBUG | INFO | WARNING | ERROR | CRITICAL
# [DEFAULT]
LOG_LEVEL=INFO

# Emit logs as JSON (true) or human-readable (false).
# [DEFAULT]
LOG_JSON=true


# ── Database ──────────────────────────────────────────────────────────────────

# SQLite (local-first, zero-config):
#   sqlite+aiosqlite:///./fillwise.db
# PostgreSQL (production-grade):
#   postgresql+asyncpg://user:password@localhost:5432/fillwise
# [REQUIRED]
DATABASE_URL=sqlite+aiosqlite:///./fillwise.db

# SQLAlchemy async connection pool (PostgreSQL only; ignored for SQLite).
# [DEFAULT]
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_RECYCLE=1800
DB_POOL_TIMEOUT=30
DB_POOL_PRE_PING=true

# Run Alembic "upgrade head" automatically on startup.
# Disable if you manage migrations out-of-band.
# [DEFAULT]
RUN_MIGRATIONS_ON_STARTUP=true


# ── Security / JWT ────────────────────────────────────────────────────────────

# MUST be a random string ≥ 32 characters.  Generate with:
#   python -c "import secrets; print(secrets.token_hex(32))"
# [REQUIRED]
JWT_SECRET=CHANGE_ME_generate_a_32_plus_char_random_string

# JWT algorithm.  Only change if you know what you are doing.
# [DEFAULT]
JWT_ALGORITHM=HS256

# Access token lifetime in minutes.
# [DEFAULT]
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60

# Refresh token lifetime in minutes (7 days by default).
# [DEFAULT]
JWT_REFRESH_TOKEN_EXPIRE_MINUTES=10080

# CSRF token header name expected by all state-changing requests.
# [DEFAULT]
CSRF_HEADER_NAME=X-CSRF-Token


# ── CORS ──────────────────────────────────────────────────────────────────────

# Comma-separated list of allowed origins for CORS pre-flight.
# In production restrict this to your actual frontend origin(s).
# [DEFAULT]
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Allow CORS credentials (cookies, auth headers).
# [DEFAULT]
CORS_ALLOW_CREDENTIALS=true


# ── Rate Limiting ─────────────────────────────────────────────────────────────

# Global default: requests per window applied to every route unless overridden.
# Format understood by slowapi: "N/second", "N/minute", "N/hour", "N/day".
# [DEFAULT]
RATE_LIMIT_DEFAULT=100/minute

# Applied to login + token-refresh routes to prevent brute-force.
# [DEFAULT]
RATE_LIMIT_AUTH=10/minute


# ── File Storage ──────────────────────────────────────────────────────────────

# Directory to store uploaded source documents.
# The path is relative to the working directory unless absolute.
# Created automatically on startup if it does not exist.
# [DEFAULT]
UPLOAD_DIR=./uploads

# Directory where assembled DOCX exports are written.
# [DEFAULT]
EXPORT_DIR=./exports

# Maximum allowed upload size in bytes (default 50 MB).
# [DEFAULT]
MAX_UPLOAD_BYTES=52428800

# Allowed MIME types (comma-separated).
# [DEFAULT]
ALLOWED_MIME_TYPES=application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document

# Maximum document page count accepted for ingestion.
# Documents exceeding this limit are rejected to protect LLM context budgets.
# [DEFAULT]
MAX_PAGE_COUNT=500


# ── Ollama / LLM ─────────────────────────────────────────────────────────────

# Base URL of your local Ollama instance (no trailing slash).
# [REQUIRED]
OLLAMA_BASE_URL=http://127.0.0.1:11434

# Model tag to use for rewrite jobs.  Must be pulled in Ollama before use:
#   ollama pull ministral:3b
# [REQUIRED]
OLLAMA_MODEL=ministral:3b

# Maximum tokens the model may generate per section.
# [DEFAULT]
OLLAMA_MAX_TOKENS=4096

# Sampling temperature (0.0 = deterministic, 1.0 = creative).
# For legal rewrites a low value is strongly recommended.
# [DEFAULT]
OLLAMA_TEMPERATURE=0.1

# HTTP request timeout in seconds for the Ollama generate API.
# Large sections at low temperatures can take longer than the default.
# [DEFAULT]
OLLAMA_REQUEST_TIMEOUT=300

# Circuit-breaker: number of consecutive errors before opening the circuit.
# [DEFAULT]
OLLAMA_CIRCUIT_BREAKER_THRESHOLD=5

# Circuit-breaker: seconds to wait in OPEN state before moving to HALF_OPEN.
# [DEFAULT]
OLLAMA_CIRCUIT_BREAKER_TIMEOUT=60


# ── Risk Analysis ─────────────────────────────────────────────────────────────

# TF-IDF cosine-similarity deviation threshold that triggers a HIGH finding.
# 0.0 = identical, 1.0 = completely different.
# [DEFAULT]
RISK_SEMANTIC_THRESHOLD=0.40

# Ratio bounds for length-anomaly detection (relative to original section len).
# Warning fired when rewrite is shorter than MIN or longer than MAX times orig.
# [DEFAULT]
RISK_LENGTH_MIN_RATIO=0.30
RISK_LENGTH_MAX_RATIO=3.00


# ── Admin bootstrap ───────────────────────────────────────────────────────────

# Username of the built-in administrator account seeded on first startup.
# [DEFAULT]
ADMIN_USERNAME=admin

# Password for the bootstrap admin account.
# MUST be ≥ 12 characters.  Change immediately after first login.
# [REQUIRED]
ADMIN_PASSWORD=CHANGE_ME_min12chars


# ── Prometheus / Observability ────────────────────────────────────────────────

# Expose Prometheus metrics at /metrics.
# [DEFAULT]
ENABLE_METRICS=true

# Enable OpenTelemetry tracing (requires OTEL_EXPORTER_OTLP_ENDPOINT set).
# [DEFAULT]
ENABLE_TRACING=false

# OTLP gRPC endpoint.  Only used when ENABLE_TRACING=true.
# [DEFAULT]
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
